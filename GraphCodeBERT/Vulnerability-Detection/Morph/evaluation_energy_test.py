import pandas as pd
import numpy as np
import logging
import csv
import argparse
import time

from mo_distill_utils import distill
from many_objective import hyperparams_convert_back

def main():
    parser = argparse.ArgumentParser(description="Train and evaluate MORPH models.")
    parser.add_argument("--model", type=str, required=True,
                        help="Model to test energy performance.")
    parser.add_argument("--use-flops", action='store_true',
                        help="Take models from FLOPs optimization instead of energy optimization.")
    args = parser.parse_args()

    model_number = int(args.model)

    seed = 2

    # Load Pareto front data and convert to array
    if args.use_flops:
        hyperparams_data = pd.read_csv('morph_results_flops.csv').to_numpy()
    else:
        hyperparams_data = pd.read_csv('morph_results_energy.csv').to_numpy()

    hyperparameters = hyperparams_data[:, :hyperparams_data.shape[1] - 4] # 2 for surrogate, 4 for final models
    objectives = hyperparams_data[:, hyperparams_data.shape[1] - 4:]

    # hyperparameters = [hyperparams_convert_back(row) for row in hyperparameters]

    hyperparams = hyperparameters[model_number]
    objs = objectives[model_number]

    eval_rounds = 30
    accs, _ = distill([hyperparams], eval=True, surrogate=True, seed=seed, model_name=f"model-{model_number}.bin", eval_rounds=eval_rounds, use_flops=args.use_flops)

    print(accs)

if __name__ == "__main__":
    main()